import unittest
import requests
from app import link_info

class RestCalls():

    def sendRequest(url, api_key = 'abc123'):
        
        header = {'api_key': api_key}
    
        try:
            r = requests.get(url,headers=header)
            return r
        except:
            print("Internal Server Error")

class AppTest(unittest.TestCase):

    def test_success_not_safe(self):
        r = RestCalls.sendRequest("http://127.0.0.1:5000/v1/urlinfo/abc.com")
        self.assertEqual(200, r.status_code)
        self.assertEqual(False, r.json()['safe'])

    def test_success_safe(self):
        r = RestCalls.sendRequest("http://127.0.0.1:5000/v1/urlinfo/google.com")
        self.assertEqual(200, r.status_code)
        self.assertEqual(True, r.json()['safe'])

    def test_wrong_key(self):
        #Passing wrong api key
        api_key = "jhbfujb"
        r = RestCalls.sendRequest("http://127.0.0.1:5000/v1/urlinfo/abc.com",api_key)
        self.assertEqual(401, r.status_code)
        self.assertEqual("Unauthorized", r.json()['error'])

if __name__ == "__main__":
    unittest.main()