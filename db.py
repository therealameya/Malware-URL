import sqlite3
from datetime import date

def init_db():
    conn = sqlite3.connect("url_db.db")
    c = conn.cursor()
    c.execute(
        "CREATE TABLE IF NOT EXISTS url_db ("
        "url TEXT PRIMARY KEY,"
        "type TEXT,"
        "date_added TEXT"
        ")"
    )
    conn.commit()
    conn.close()

def add_url(url, url_type):
    conn = sqlite3.connect("url_db.db")
    c = conn.cursor()
    date_added = date.today()
    c.execute(
        "INSERT OR IGNORE INTO url_db (url, type, date_added) "
        "VALUES (?, ?, ?)",
        (url, url_type, date_added)
    )
    conn.commit()
    conn.close()

def remove_url(url):
    conn = sqlite3.connect("url_db.db")
    c = conn.cursor()
    c.execute("DELETE FROM url_db WHERE url = ?", (url,))
    conn.commit()
    conn.close()

def get_url_info(url):

    conn = sqlite3.connect("url_db.db")
    c = conn.cursor()
    c.execute("SELECT * FROM url_db WHERE url = ?", (url,))
    row = c.fetchone()

    conn.close()
    if row:
        return {
            "url": row[0],
            "type": row[1],
            "date_added": row[2]
        }
    else:
        return None

def create_url_index():
    conn = sqlite3.connect("malware.db")
    c = conn.cursor()
    c.execute("CREATE INDEX IF NOT EXISTS url_index ON malware_urls (url)")
    conn.commit()
    conn.close()


if __name__=="__main__":
    # Initialize the database
    init_db()
    create_url_index()
    # Add some sample URLs to the database
    add_url("abc.com", "Trojan", "2022-01-01")
    add_url("xyz.com", "Ransomware", "2022-02-01")